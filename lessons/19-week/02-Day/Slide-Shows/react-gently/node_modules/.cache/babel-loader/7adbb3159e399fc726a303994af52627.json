{"ast":null,"code":"Object.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _fromPairs2 = require(\"lodash/fromPairs\");\n\nvar _fromPairs3 = _interopRequireDefault(_fromPairs2);\n\nvar _defaults2 = require(\"lodash/defaults\");\n\nvar _defaults3 = _interopRequireDefault(_defaults2);\n\nvar _partialRight2 = require(\"lodash/partialRight\");\n\nvar _partialRight3 = _interopRequireDefault(_partialRight2);\n\nvar _isFunction2 = require(\"lodash/isFunction\");\n\nvar _isFunction3 = _interopRequireDefault(_isFunction2);\n\nvar _assign2 = require(\"lodash/assign\");\n\nvar _assign3 = _interopRequireDefault(_assign2);\n\nvar _jsxFileName = \"src/victory-shared-events/victory-shared-events.js\";\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _propTypes3 = require(\"../victory-util/prop-types\");\n\nvar _propTypes4 = _interopRequireDefault(_propTypes3);\n\nvar _events = require(\"../victory-util/events\");\n\nvar _events2 = _interopRequireDefault(_events);\n\nvar _helpers = require(\"../victory-util/helpers\");\n\nvar _helpers2 = _interopRequireDefault(_helpers);\n\nvar _timer = require(\"../victory-util/timer\");\n\nvar _timer2 = _interopRequireDefault(_timer);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  } else {\n    return Array.from(arr);\n  }\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar VictorySharedEvents = function (_React$Component) {\n  _inherits(VictorySharedEvents, _React$Component);\n\n  function VictorySharedEvents() {\n    _classCallCheck(this, VictorySharedEvents);\n\n    var _this = _possibleConstructorReturn(this, (VictorySharedEvents.__proto__ || Object.getPrototypeOf(VictorySharedEvents)).call(this));\n\n    _this.state = _this.state || {};\n    _this.getScopedEvents = _events2.default.getScopedEvents.bind(_this);\n    _this.getEventState = _events2.default.getEventState.bind(_this);\n    _this.getTimer = _this.getTimer.bind(_this);\n    return _this;\n  }\n\n  _createClass(VictorySharedEvents, [{\n    key: \"getChildContext\",\n    value: function getChildContext() {\n      return {\n        getTimer: this.getTimer\n      };\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      this.setUpChildren(this.props);\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(newProps) {\n      this.setUpChildren(newProps);\n    }\n  }, {\n    key: \"getTimer\",\n    value: function getTimer() {\n      if (this.context.getTimer) {\n        return this.context.getTimer();\n      }\n\n      if (!this.timer) {\n        this.timer = new _timer2.default();\n      }\n\n      return this.timer;\n    }\n  }, {\n    key: \"getAllEvents\",\n    value: function getAllEvents(props) {\n      var components = [\"container\", \"groupComponent\"];\n      this.componentEvents = _events2.default.getComponentEvents(props, components);\n\n      if (Array.isArray(this.componentEvents)) {\n        var _componentEvents;\n\n        return Array.isArray(props.events) ? (_componentEvents = this.componentEvents).concat.apply(_componentEvents, _toConsumableArray(props.events)) : this.componentEvents;\n      }\n\n      return props.events;\n    }\n  }, {\n    key: \"setUpChildren\",\n    value: function setUpChildren(props) {\n      this.events = this.getAllEvents(props);\n\n      if (this.events) {\n        this.childComponents = _react2.default.Children.toArray(props.children);\n        var childBaseProps = this.getBasePropsFromChildren(this.childComponents);\n        var parentBaseProps = props.container ? props.container.props : {};\n        this.baseProps = (0, _assign3.default)({}, childBaseProps, {\n          parent: parentBaseProps\n        });\n      }\n    }\n  }, {\n    key: \"getBasePropsFromChildren\",\n    value: function getBasePropsFromChildren(childComponents) {\n      var iteratee = function iteratee(child, childName, parent) {\n        if (child.type && (0, _isFunction3.default)(child.type.getBaseProps)) {\n          child = parent ? _react2.default.cloneElement(child, parent.props) : child;\n\n          var _baseProps = child.props && child.type.getBaseProps(child.props);\n\n          return _baseProps ? [[childName, _baseProps]] : null;\n        } else {\n          return null;\n        }\n      };\n\n      var baseProps = _helpers2.default.reduceChildren(childComponents, iteratee);\n\n      return (0, _fromPairs3.default)(baseProps);\n    }\n  }, {\n    key: \"getNewChildren\",\n    value: function getNewChildren(props) {\n      var _this2 = this;\n\n      var events = props.events,\n          eventKey = props.eventKey;\n      var childNames = Object.keys(this.baseProps);\n\n      var alterChildren = function alterChildren(children) {\n        return children.reduce(function (memo, child, index) {\n          if (child.props.children) {\n            return memo.concat(_react2.default.cloneElement(child, child.props, alterChildren(_react2.default.Children.toArray(child.props.children))));\n          } else if (child.type && (0, _isFunction3.default)(child.type.getBaseProps)) {\n            var name = child.props.name || childNames.shift() || index;\n            var childEvents = Array.isArray(events) && events.filter(function (event) {\n              if (event.target === \"parent\") {\n                return false;\n              }\n\n              return Array.isArray(event.childName) ? event.childName.indexOf(name) > -1 : event.childName === name || event.childName === \"all\";\n            });\n            var sharedEvents = {\n              events: childEvents,\n              getEvents: (0, _partialRight3.default)(_this2.getScopedEvents, name, _this2.baseProps),\n              getEventState: (0, _partialRight3.default)(_this2.getEventState, name)\n            };\n            return memo.concat(_react2.default.cloneElement(child, (0, _assign3.default)({\n              key: \"events-\" + name,\n              sharedEvents: sharedEvents,\n              eventKey: eventKey\n            }, child.props)));\n          } else {\n            return memo.concat(child);\n          }\n        }, []);\n      };\n\n      return alterChildren(this.childComponents);\n    }\n  }, {\n    key: \"getContainer\",\n    value: function getContainer(props, children) {\n      var parents = Array.isArray(this.events) && this.events.filter(function (event) {\n        return event.target === \"parent\";\n      });\n      var sharedEvents = parents.length > 0 ? {\n        events: parents,\n        getEvents: (0, _partialRight3.default)(this.getScopedEvents, null, this.baseProps),\n        getEventState: (0, _partialRight3.default)(this.getEventState, null)\n      } : null;\n      var container = this.props.container || this.props.groupComponent;\n      var containerProps = container.props || {};\n\n      var boundGetEvents = _events2.default.getEvents.bind(this);\n\n      var parentEvents = sharedEvents && boundGetEvents({\n        sharedEvents: sharedEvents\n      }, \"parent\");\n      var parentProps = (0, _defaults3.default)({}, this.getEventState(\"parent\", \"parent\"), containerProps, this.baseProps.parent, {\n        children: children\n      });\n      var events = (0, _defaults3.default)({}, _events2.default.getPartialEvents(parentEvents, \"parent\", parentProps), containerProps.events);\n      return _react2.default.cloneElement(container, (0, _assign3.default)({}, parentProps, {\n        events: events\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.events) {\n        var children = this.getNewChildren(this.props);\n        return this.getContainer(this.props, children);\n      }\n\n      return _react2.default.cloneElement(this.props.container, {\n        children: this.props.children\n      });\n    }\n  }]);\n\n  return VictorySharedEvents;\n}(_react2.default.Component);\n\nVictorySharedEvents.displayName = \"VictorySharedEvents\";\nVictorySharedEvents.role = \"shared-event-wrapper\";\nVictorySharedEvents.propTypes = {\n  children: _propTypes2.default.oneOfType([_propTypes2.default.arrayOf(_propTypes2.default.node), _propTypes2.default.node]),\n  container: _propTypes2.default.node,\n  eventKey: _propTypes2.default.oneOfType([_propTypes2.default.array, _propTypes2.default.func, _propTypes4.default.allOfType([_propTypes4.default.integer, _propTypes4.default.nonNegative]), _propTypes2.default.string]),\n  events: _propTypes2.default.arrayOf(_propTypes2.default.shape({\n    childName: _propTypes2.default.oneOfType([_propTypes2.default.string, _propTypes2.default.array]),\n    eventHandlers: _propTypes2.default.object,\n    eventKey: _propTypes2.default.oneOfType([_propTypes2.default.array, _propTypes2.default.func, _propTypes4.default.allOfType([_propTypes4.default.integer, _propTypes4.default.nonNegative]), _propTypes2.default.string]),\n    target: _propTypes2.default.string\n  })),\n  groupComponent: _propTypes2.default.node\n};\nVictorySharedEvents.defaultProps = {\n  groupComponent: _react2.default.createElement(\"g\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44\n    }\n  })\n};\nVictorySharedEvents.contextTypes = {\n  getTimer: _propTypes2.default.func\n};\nVictorySharedEvents.childContextTypes = {\n  getTimer: _propTypes2.default.func\n};\nexports.default = VictorySharedEvents;","map":null,"metadata":{},"sourceType":"script"}